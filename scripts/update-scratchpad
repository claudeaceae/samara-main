#!/bin/bash
# Update the Claude Scratchpad and record the hash
# This marks the content as "my edit" so we can detect when Ã‰ changes it
#
# Usage: update-scratchpad "new content to add"
# Or: echo "content" | update-scratchpad --stdin

MIND_PATH="${SAMARA_MIND_PATH:-${MIND_PATH:-$HOME/.claude-mind}}"
STATE_DIR="$MIND_PATH/state"
HASH_FILE="$STATE_DIR/scratchpad-hash.txt"
source "$MIND_PATH/system/lib/config.sh" 2>/dev/null || source "$MIND_PATH/lib/config.sh" 2>/dev/null || true

SCRATCHPAD_PATH="${SCRATCHPAD_FILE:-$MIND_PATH/shared/scratchpad.md}"

# Get content to write
if [[ "$1" == "--stdin" ]]; then
    NEW_CONTENT=$(cat)
elif [[ -n "$1" ]]; then
    NEW_CONTENT="$1"
else
    echo "Usage: update-scratchpad 'content' OR echo 'content' | update-scratchpad --stdin"
    exit 1
fi

mkdir -p "$(dirname "$SCRATCHPAD_PATH")"
echo "$NEW_CONTENT" > "$SCRATCHPAD_PATH"
ACTUAL_CONTENT=$(cat "$SCRATCHPAD_PATH")

# Store the hash
echo "$ACTUAL_CONTENT" | shasum -a 256 | cut -d' ' -f1 > "$HASH_FILE"

echo "Scratchpad updated at $SCRATCHPAD_PATH and hash recorded"
