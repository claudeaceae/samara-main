#!/bin/bash
# screenshot: Take screenshot and send to collaborator
#
# Uses Pictures folder workaround (discovered 2025-12-21).
# No UI automation - purely programmatic.
#
# Usage: screenshot

# Load config (required)
MIND_PATH="${SAMARA_MIND_PATH:-${MIND_PATH:-$HOME/.claude-mind}}"

source "$MIND_PATH/lib/config.sh" 2>/dev/null || source "$MIND_PATH/system/lib/config.sh" 2>/dev/null || {
    echo "Error: config.sh not found" >&2
    exit 1
}

if [ -z "$COLLABORATOR_PHONE" ]; then
    echo "Error: COLLABORATOR_PHONE not set in config.json" >&2
    exit 1
fi

TEMP_FILE="/tmp/screenshot-$(date +%s).png"

# Capture screenshot
screencapture -x "$TEMP_FILE"

if [ ! -f "$TEMP_FILE" ]; then
    echo "Error: Failed to capture screenshot"
    exit 1
fi

# Send it
"$MIND_PATH/system/bin/send-attachment" "$TEMP_FILE" "$COLLABORATOR_PHONE"

# Clean up
rm -f "$TEMP_FILE"
